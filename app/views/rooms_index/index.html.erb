<div style="max-width: 600px; margin: 2rem auto; padding: 0 20px;">
  <h2 style="font-weight: 900; margin-bottom: 1.5rem; font-size: 1.4rem;">メッセージ</h2>
  
  <div style="background: white; border: 1px solid var(--border-color); border-radius: 16px; overflow: hidden;">
    <% if @rooms.any? %>
      <% @rooms.each do |room| %>
        <% opponent = room.entries.where.not(user_id: current_user.id).first.user %>
        <% last_message = room.messages.order(created_at: :desc).first %>
        <% unread = room.messages.where.not(user_id: current_user.id).where(checked: false) %>

        <%= link_to room_path(room), style: "text-decoration: none; color: inherit;" do %>
          <div style="padding: 16px; display: flex; gap: 12px; border-bottom: 1px solid var(--border-color); transition: background 0.2s; background-color: <%= unread.any? ? '#f7f9f9' : 'transparent' %>;">
            <% if opponent.profile_image.attached? %>
              <%= image_tag opponent.profile_image, style: "width: 48px; height: 48px; border-radius: 50%; object-fit: cover;" %>
            <% else %>
              <div style="width: 48px; height: 48px; border-radius: 50%; background: #e1e8ed;"></div>
            <% end %>
            
            <div style="flex: 1; overflow: hidden;">
              <div style="display: flex; justify-content: space-between; align-items: baseline;">
                <span style="font-weight: bold;"><%= opponent.nickname.presence || opponent.email %></span>
                <span style="font-size: 0.8rem; color: var(--text-sub);"><%= last_message&.created_at&.strftime("%m月%d日") %></span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 4px;">
                <p style="margin: 0; font-size: 0.9rem; color: var(--text-sub); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                  <%= last_message&.content.presence || "会話を始めましょう" %>
                </p>
                <% if unread.any? %>
                  <div style="background: var(--primary-color); width: 8px; height: 8px; border-radius: 50%;"></div>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    <% else %>
      <div style="padding: 40px; text-align: center; color: var(--text-sub);">
        <p>メッセージはまだありません</p>
      </div>
    <% end %>
  </div>
</div>